// Package oapi provides primitives to interact with the openapi HTTP API.
//
// Code generated by github.com/oapi-codegen/oapi-codegen/v2 version v2.5.1 DO NOT EDIT.
package oapi

import (
	"github.com/gin-gonic/gin"
)

const (
	RefreshTokenCookieScopes = "RefreshTokenCookie.Scopes"
	BearerAuthScopes         = "bearerAuth.Scopes"
)

// Defines values for Role.
const (
	Admin  Role = "admin"
	Member Role = "member"
	None   Role = "none"
)

// AccessTokenResponse defines model for AccessTokenResponse.
type AccessTokenResponse struct {
	// Exp Unix timestamp (seconds since epoch) when the access token expires.
	Exp *int64 `json:"exp,omitempty"`

	// Token JWT access token (store in memory; avoid localStorage if possible)
	Token string `json:"token"`
}

// Account defines model for Account.
type Account struct {
	Email    Email    `json:"email"`
	Fullname Fullname `json:"fullname"`

	// PhoneNumber Abide by the E.164 standard
	PhoneNumber *PhoneNumber `json:"phoneNumber,omitempty"`
	Role        Role         `json:"role"`
	Username    Username     `json:"username"`
}

// Email defines model for Email.
type Email = string

// ErrorResponse defines model for ErrorResponse.
type ErrorResponse struct {
	Code    string                  `json:"code"`
	Details *map[string]interface{} `json:"details,omitempty"`
	Message string                  `json:"message"`
}

// Fullname defines model for Fullname.
type Fullname = string

// Password 8-72 characters, including at least one uppercase, one lowercase, one digit, and one special character; no whitespace.
type Password = string

// PhoneNumber Abide by the E.164 standard
type PhoneNumber struct {
	CountryCode *string `json:"countryCode,omitempty"`
	Number      *string `json:"number,omitempty"`
}

// RefreshResponse defines model for RefreshResponse.
type RefreshResponse struct {
	AccessToken AccessTokenResponse `json:"accessToken"`
}

// Role defines model for Role.
type Role string

// SigninRequest defines model for SigninRequest.
type SigninRequest struct {
	// IsRememberMe If true, server may issue longer refresh token lifetime.
	IsRememberMe *bool `json:"isRememberMe,omitempty"`

	// Password 8-72 characters, including at least one uppercase, one lowercase, one digit, and one special character; no whitespace.
	Password *Password `json:"password,omitempty"`
	Username Username  `json:"username"`
}

// SigninResponse defines model for SigninResponse.
type SigninResponse struct {
	AccessToken AccessTokenResponse `json:"accessToken"`
}

// SignupRequest defines model for SignupRequest.
type SignupRequest struct {
	Account Account `json:"account"`

	// Password 8-72 characters, including at least one uppercase, one lowercase, one digit, and one special character; no whitespace.
	Password *Password `json:"password,omitempty"`
}

// SignupResponse defines model for SignupResponse.
type SignupResponse struct {
	AccessToken AccessTokenResponse `json:"accessToken"`
}

// Username defines model for Username.
type Username = string

// UsersMeResponse defines model for UsersMeResponse.
type UsersMeResponse struct {
	Account Account `json:"account"`
}

// BadRequest defines model for BadRequest.
type BadRequest = ErrorResponse

// Forbidden defines model for Forbidden.
type Forbidden = ErrorResponse

// InternalServerError defines model for InternalServerError.
type InternalServerError = ErrorResponse

// NotFound defines model for NotFound.
type NotFound = ErrorResponse

// TooManyRequests defines model for TooManyRequests.
type TooManyRequests = ErrorResponse

// Unauthorized defines model for Unauthorized.
type Unauthorized = ErrorResponse

// SignInJSONRequestBody defines body for SignIn for application/json ContentType.
type SignInJSONRequestBody = SigninRequest

// SignUpJSONRequestBody defines body for SignUp for application/json ContentType.
type SignUpJSONRequestBody = SignupRequest

// ServerInterface represents all server handlers.
type ServerInterface interface {
	// Sign in
	// (POST /auth/signin)
	SignIn(c *gin.Context)
	// Sign up a new account
	// (POST /auth/signup)
	SignUp(c *gin.Context)
	// Refresh access token using refresh token
	// (POST /auth/token/refresh)
	RefreshToken(c *gin.Context)
	// Sign out and revoke refresh token
	// (POST /auth/token/signout)
	SignOut(c *gin.Context)
	// Get current user information
	// (GET /users/me)
	GetMe(c *gin.Context)
}

// ServerInterfaceWrapper converts contexts to parameters.
type ServerInterfaceWrapper struct {
	Handler            ServerInterface
	HandlerMiddlewares []MiddlewareFunc
	ErrorHandler       func(*gin.Context, error, int)
}

type MiddlewareFunc func(c *gin.Context)

// SignIn operation middleware
func (siw *ServerInterfaceWrapper) SignIn(c *gin.Context) {

	for _, middleware := range siw.HandlerMiddlewares {
		middleware(c)
		if c.IsAborted() {
			return
		}
	}

	siw.Handler.SignIn(c)
}

// SignUp operation middleware
func (siw *ServerInterfaceWrapper) SignUp(c *gin.Context) {

	for _, middleware := range siw.HandlerMiddlewares {
		middleware(c)
		if c.IsAborted() {
			return
		}
	}

	siw.Handler.SignUp(c)
}

// RefreshToken operation middleware
func (siw *ServerInterfaceWrapper) RefreshToken(c *gin.Context) {

	c.Set(RefreshTokenCookieScopes, []string{})

	for _, middleware := range siw.HandlerMiddlewares {
		middleware(c)
		if c.IsAborted() {
			return
		}
	}

	siw.Handler.RefreshToken(c)
}

// SignOut operation middleware
func (siw *ServerInterfaceWrapper) SignOut(c *gin.Context) {

	c.Set(BearerAuthScopes, []string{})

	c.Set(RefreshTokenCookieScopes, []string{})

	for _, middleware := range siw.HandlerMiddlewares {
		middleware(c)
		if c.IsAborted() {
			return
		}
	}

	siw.Handler.SignOut(c)
}

// GetMe operation middleware
func (siw *ServerInterfaceWrapper) GetMe(c *gin.Context) {

	c.Set(BearerAuthScopes, []string{})

	for _, middleware := range siw.HandlerMiddlewares {
		middleware(c)
		if c.IsAborted() {
			return
		}
	}

	siw.Handler.GetMe(c)
}

// GinServerOptions provides options for the Gin server.
type GinServerOptions struct {
	BaseURL      string
	Middlewares  []MiddlewareFunc
	ErrorHandler func(*gin.Context, error, int)
}

// RegisterHandlers creates http.Handler with routing matching OpenAPI spec.
func RegisterHandlers(router gin.IRouter, si ServerInterface) {
	RegisterHandlersWithOptions(router, si, GinServerOptions{})
}

// RegisterHandlersWithOptions creates http.Handler with additional options
func RegisterHandlersWithOptions(router gin.IRouter, si ServerInterface, options GinServerOptions) {
	errorHandler := options.ErrorHandler
	if errorHandler == nil {
		errorHandler = func(c *gin.Context, err error, statusCode int) {
			c.JSON(statusCode, gin.H{"msg": err.Error()})
		}
	}

	wrapper := ServerInterfaceWrapper{
		Handler:            si,
		HandlerMiddlewares: options.Middlewares,
		ErrorHandler:       errorHandler,
	}

	router.POST(options.BaseURL+"/auth/signin", wrapper.SignIn)
	router.POST(options.BaseURL+"/auth/signup", wrapper.SignUp)
	router.POST(options.BaseURL+"/auth/token/refresh", wrapper.RefreshToken)
	router.POST(options.BaseURL+"/auth/token/signout", wrapper.SignOut)
	router.GET(options.BaseURL+"/users/me", wrapper.GetMe)
}
